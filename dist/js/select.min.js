!function(e,t){"function"==typeof define&&define.amd?define(t):"object"==typeof exports?module.exports=t(require,exports,module):e.Select=t()}(this,function(e,t,i){"use strict";function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(){var e=window.innerWidth,t=window.innerHeight;return k&&(640>=e||640>=t)}function r(e){return Array.prototype.reduce.call(e,function(e,t){return e===t?t:!1})}function l(){var e=document.querySelector(".select-target-focused");return e?e.selectInstance:null}var a=function(e,t,i){for(var n=!0;n;){var o=e,s=t,r=i;n=!1,null===o&&(o=Function.prototype);var l=Object.getOwnPropertyDescriptor(o,s);if(void 0!==l){if("value"in l)return l.value;var a=l.get;if(void 0===a)return;return a.call(r)}var c=Object.getPrototypeOf(o);if(null===c)return;e=c,t=s,i=r,n=!0,l=c=void 0}},c=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),u=function(){function e(){o(this,e)}return c(e,[{key:"on",value:function(e,t,i){var n=arguments.length<=3||void 0===arguments[3]?!1:arguments[3];"undefined"==typeof this.bindings&&(this.bindings={}),"undefined"==typeof this.bindings[e]&&(this.bindings[e]=[]),this.bindings[e].push({handler:t,ctx:i,once:n})}},{key:"once",value:function(e,t,i){this.on(e,t,i,!0)}},{key:"off",value:function(e,t){if("undefined"==typeof this.bindings||"undefined"==typeof this.bindings[e])if("undefined"==typeof t)delete this.bindings[e];else for(var i=0;i<this.bindings[e].length;)this.bindings[e][i].handler===t?this.bindings[e].splice(i,1):++i}},{key:"trigger",value:function(e){if("undefined"!=typeof this.bindings&&this.bindings[e]){for(var t=0,i=arguments.length,n=Array(i>1?i-1:0),o=1;i>o;o++)n[o-1]=arguments[o];for(;t<this.bindings[e].length;){var s=this.bindings[e][t],r=s.handler,l=s.ctx,a=s.once,c=l;"undefined"==typeof c&&(c=this),r.apply(c,n),a?this.bindings[e].splice(t,1):++t}}}}]),e}(),h=function(e,t,i){return Object.assign(e,t,i)},d=function(e,t){window.jQuery?$(e).addClass(t):e.classList?e.classList.add(t):e.className+=" "+t},p=function(e,t){window.jQuery?$(e).removeClass(t):e.classList?e.classList.remove(t):e.className=e.className.replace(new RegExp("(^|\\b)"+t.split(" ").join("|")+"(\\b|$)","gi")," ")},f=function(e,t){return window.jQuery?$(e).hasClass(t):e.classList?e.classList.contains(t):new RegExp("(^| )"+t+"( |$)","gi").test(e.className)},g=function(e){if(window.jQuery){var t=$(e).offset(),i=$(e).outerWidth(),n=$(e).outerHeight();return Object.assign(t,{width:i},{height:n})}var o=e.getBoundingClientRect();return{top:o.top+document.body.scrollTop,left:o.left+document.body.scrollLeft,width:e.offsetWidth,height:e.offsetHeight}},v=13,y=27,b=32,m=38,O=40,k="ontouchstart"in document.documentElement,w=k?"touchstart":"click",C="",E=void 0;document.addEventListener("keypress",function(e){var t=l();if(t&&0!==e.charCode){e.keyCode===b&&e.preventDefault(),clearTimeout(E),E=setTimeout(function(){C=""},500),C+=String.fromCharCode(e.charCode);var i=t.findOptionsByPrefix(C);if(1===i.length&&t.selectOption(i[0]),C.length>1&&r(C)){var n=t.findOptionsByPrefix(C[0]);if(n.length){var o=n.indexOf(t.getChosen());return o+=1,o%=n.length,void t.selectOption(n[o])}}i.length&&t.selectOption(i[0])}}),document.addEventListener("keydown",function(e){var t=l();if(t)if([m,O,y].indexOf(e.keyCode)>=0&&e.preventDefault(),t.isOpen())switch(e.keyCode){case m:case O:t.moveHighlight(e.keyCode);break;case v:t.selectHighlightedOption();break;case y:t.close(),t.target.focus()}else[m,O,b].indexOf(e.keyCode)>=0&&t.open()});var T=function(e){function t(e){if(o(this,t),a(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this.options=h({},t.defaults,e),this.select=this.options.el,this.select){if("undefined"!=typeof this.select.selectInstance)throw new Error("This element has already been turned into a Select");this.update=this.update.bind(this),this.setupTarget(),this.renderTarget(),this.setupDrop(),this.renderDrop(),this.setupSelect(),this.setupTether(),this.bindClick(),this.bindMutationEvents(),this.value=this.select.value}}return n(t,e),c(t,[{key:"useNative",value:function(){var e=this.options.useNative;return e===!0||s()&&e!==!1}},{key:"setupTarget",value:function(){var e=this;this.target=document.createElement("a"),this.target.href="javascript:;",d(this.target,"select-target");var t=this.select.getAttribute("tabindex")||0;this.target.setAttribute("tabindex",t),this.options.className&&d(this.target,this.options.className),this.target.selectInstance=this,this.target.addEventListener("click",function(){e.isOpen()?e.target.blur():e.target.focus()}),this.target.addEventListener("focus",function(){d(e.target,"select-target-focused")}),this.target.addEventListener("blur",function(t){var i=t.relatedTarget;e.isOpen()&&i&&!e.drop.contains(i)&&e.close(),p(e.target,"select-target-focused")}),this.select.parentNode.insertBefore(this.target,this.select.nextSibling)}},{key:"setupDrop",value:function(){var e=this;this.drop=document.createElement("div"),d(this.drop,"select"),d(this.drop,"select-element"),this.options.className&&d(this.drop,this.options.className),document.body.appendChild(this.drop),this.drop.addEventListener("click",function(t){f(t.target,"select-option")&&e.pickOption(t.target),t.stopPropagation()}),this.drop.addEventListener("mousemove",function(t){f(t.target,"select-option")&&e.highlightOption(t.target)}),this.content=document.createElement("div"),d(this.content,"select-content"),this.drop.appendChild(this.content)}},{key:"open",value:function(){var e=this;if(d(this.target,"select-open"),this.useNative()){var t=document.createEvent("MouseEvents");return t.initEvent("mousedown",!0,!0),void this.select.dispatchEvent(t)}d(this.drop,"select-open"),setTimeout(function(){e.tether.enable()});var i=this.drop.querySelector(".select-option-selected");if(i){this.highlightOption(i),this.scrollDropContentToOption(i);var n=function(){if(f(e.drop,"tether-abutted-left")||f(e.drop,"tether-abutted-bottom")){var t=g(e.drop),n=g(i),o=t.top-(n.top+n.height);e.drop.style.top=(parseFloat(e.drop.style.top)||0)+o+"px"}},o=this.options.alignToHighlighted,s=this.content,r=s.scrollHeight,l=s.clientHeight;("always"===o||"auto"===o&&l>=r)&&setTimeout(function(){n()}),this.trigger("open")}}},{key:"close",value:function(){p(this.target,"select-open"),this.useNative()&&this.select.blur(),this.tether.disable(),p(this.drop,"select-open"),this.trigger("close")}},{key:"toggle",value:function(){this.isOpen()?this.close():this.open()}},{key:"isOpen",value:function(){return f(this.drop,"select-open")}},{key:"bindClick",value:function(){var e=this;this.target.addEventListener(w,function(t){t.preventDefault(),e.toggle()}),document.addEventListener(w,function(t){e.isOpen()&&(t.target===e.drop||e.drop.contains(t.target)||t.target===e.target||e.target.contains(t.target)||e.close())})}},{key:"setupTether",value:function(){var e=this;window.setTimeout(function(){var t=g(e.target),i=t.left,n=t.top,o=t.width,s=t.height;console.log(i,n,o,s,e.target.innerHTML),n+=s,$(e.drop).css({"min-width":o,position:"absolute",left:i+"px",top:n+"px"});var r=e;e.tether={enable:function(){$(r.drop).addClass("enabled"),$(r.target).addClass("enabled")},disable:function(){$(r.drop).removeClass("enabled"),$(r.target).removeClass("enabled")}}},100)}},{key:"renderTarget",value:function(){this.target.innerHTML="";for(var e=this.select.querySelectorAll("option"),t=0;t<e.length;++t){var i=e[t];if(i.selected){this.target.innerHTML=i.innerHTML;break}}this.target.appendChild(document.createElement("b"))}},{key:"renderDrop",value:function(){var e=document.createElement("ul");d(e,"select-options");for(var t=this.select.querySelectorAll("option"),i=0;i<t.length;++i){var n=t[i],o=document.createElement("li");d(o,"select-option"),o.setAttribute("data-value",n.value),o.innerHTML=n.innerHTML,n.selected&&d(o,"select-option-selected"),e.appendChild(o)}this.content.innerHTML="",this.content.appendChild(e)}},{key:"update",value:function(){this.renderDrop(),this.renderTarget()}},{key:"setupSelect",value:function(){this.select.selectInstance=this,d(this.select,"select-select"),this.select.addEventListener("change",this.update)}},{key:"bindMutationEvents",value:function(){"undefined"!=typeof window.MutationObserver?(this.observer=new MutationObserver(this.update),this.observer.observe(this.select,{childList:!0,attributes:!0,characterData:!0,subtree:!0})):this.select.addEventListener("DOMSubtreeModified",this.update)}},{key:"findOptionsByPrefix",value:function(e){var t=this.drop.querySelectorAll(".select-option");return e=e.toLowerCase(),Array.prototype.filter.call(t,function(t){return t.innerHTML.toLowerCase().substr(0,e.length)===e})}},{key:"findOptionsByValue",value:function(e){var t=this.drop.querySelectorAll(".select-option");return Array.prototype.filter.call(t,function(t){return t.getAttribute("data-value")===e})}},{key:"getChosen",value:function(){return this.isOpen()?this.drop.querySelector(".select-option-highlight"):this.drop.querySelector(".select-option-selected")}},{key:"selectOption",value:function(e){this.isOpen()?(this.highlightOption(e),this.scrollDropContentToOption(e)):this.pickOption(e,!1)}},{key:"resetSelection",value:function(){this.selectOption(this.drop.querySelector(".select-option"))}},{key:"highlightOption",value:function(e){var t=this.drop.querySelector(".select-option-highlight");t&&p(t,"select-option-highlight"),d(e,"select-option-highlight"),this.trigger("highlight",{option:e})}},{key:"moveHighlight",value:function(e){var t=this.drop.querySelector(".select-option-highlight");if(!t)return void this.highlightOption(this.drop.querySelector(".select-option"));var i=this.drop.querySelectorAll(".select-option"),n=Array.prototype.indexOf.call(i,t);if(n>=0&&(e===m?n-=1:n+=1,!(0>n||n>=i.length))){var o=i[n];this.highlightOption(o),this.scrollDropContentToOption(o)}}},{key:"scrollDropContentToOption",value:function(e){var t=this.content,i=t.scrollHeight,n=t.clientHeight,o=t.scrollTop;if(i>n){var s=g(this.content),r=g(e);this.content.scrollTop=r.top-(s.top-o)}}},{key:"selectHighlightedOption",value:function(){this.pickOption(this.drop.querySelector(".select-option-highlight"))}},{key:"pickOption",value:function(e){var t=this,i=arguments.length<=1||void 0===arguments[1]?!0:arguments[1];this.value=this.select.value=e.getAttribute("data-value"),this.triggerChange(),i&&setTimeout(function(){t.close(),t.target.focus()})}},{key:"triggerChange",value:function(){var e=document.createEvent("HTMLEvents");e.initEvent("change",!0,!1),this.select.dispatchEvent(e),this.trigger("change",{value:this.select.value})}},{key:"change",value:function(e){var t=this.findOptionsByValue(e);if(!t.length)throw new Error('Select Error: An option with the value "'+e+"\" doesn't exist");this.pickOption(t[0],!1)}}]),t}(u);return T.defaults={alignToHighlighed:"auto",className:"select-theme-default"},T.init=function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];if("loading"===document.readyState)return void document.addEventListener("DOMContentLoaded",function(){return T.init(e)});"undefined"==typeof e.selector&&(e.selector="select");for(var t=document.querySelectorAll(e.selector),i=0;i<t.length;++i){var n=t[i];n.selectInstance||new T(h({el:n},e))}},T});